<!doctype html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Test GTM - Taxi Les Sables d'Olonne</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        padding: 20px;
      }
      .test-section {
        margin: 20px 0;
        padding: 15px;
        border: 1px solid #ddd;
        border-radius: 5px;
      }
      .result {
        padding: 10px;
        margin: 10px 0;
        border-radius: 5px;
      }
      .success {
        background-color: #d4edda;
        border: 1px solid #c3e6cb;
        color: #155724;
      }
      .error {
        background-color: #f8d7da;
        border: 1px solid #f5c6cb;
        color: #721c24;
      }
      .info {
        background-color: #d1ecf1;
        border: 1px solid #bee5eb;
        color: #0c5460;
      }
      button {
        padding: 10px 15px;
        margin: 5px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
      }
      .btn-primary {
        background-color: #007bff;
        color: white;
      }
      .btn-success {
        background-color: #28a745;
        color: white;
      }
      .btn-warning {
        background-color: #ffc107;
        color: black;
      }
      #dataLayerContent {
        background-color: #f8f9fa;
        padding: 10px;
        border-radius: 5px;
        font-family: monospace;
        white-space: pre-wrap;
        max-height: 200px;
        overflow-y: auto;
      }
    </style>
  </head>
  <body>
    <h1>🧪 Test GTM - Taxi Les Sables d'Olonne</h1>

    <div class="test-section">
      <h2>📊 État de GTM</h2>
      <div id="gtmStatus"></div>
      <button class="btn-primary" onclick="checkGTMStatus()">Vérifier GTM</button>
    </div>

    <div class="test-section">
      <h2>📞 Test des appels téléphoniques</h2>
      <button class="btn-success" onclick="testPhoneCall('test_manual')">Test Appel</button>
      <button class="btn-success" onclick="testPhoneCall('header_desktop')">
        Test Header Desktop
      </button>
      <button class="btn-success" onclick="testPhoneCall('contact_page')">Test Contact Page</button>
    </div>

    <div class="test-section">
      <h2>📄 Test des pages vues</h2>
      <button class="btn-success" onclick="testPageView('homepage')">Test Homepage</button>
      <button class="btn-success" onclick="testPageView('services')">Test Services</button>
      <button class="btn-success" onclick="testPageView('contact')">Test Contact</button>
    </div>

    <div class="test-section">
      <h2>🛎️ Test des services</h2>
      <button class="btn-success" onclick="testServiceClick('medical_transport')">
        Transport Médical
      </button>
      <button class="btn-success" onclick="testServiceClick('airport_shuttle')">
        Navette Aéroport
      </button>
      <button class="btn-success" onclick="testServiceClick('local_taxi')">Taxi Local</button>
    </div>

    <div class="test-section">
      <h2>📝 Test du formulaire</h2>
      <button class="btn-success" onclick="testFormSubmission(true)">Formulaire Succès</button>
      <button class="btn-warning" onclick="testFormSubmission(false)">Formulaire Échec</button>
    </div>

    <div class="test-section">
      <h2>📊 DataLayer en temps réel</h2>
      <button class="btn-primary" onclick="updateDataLayerDisplay()">Actualiser DataLayer</button>
      <button class="btn-warning" onclick="clearDataLayer()">Vider DataLayer</button>
      <div id="dataLayerContent"></div>
    </div>

    <script>
      // Initialiser le dataLayer si pas présent
      window.dataLayer = window.dataLayer || []

      function checkGTMStatus() {
        const statusDiv = document.getElementById('gtmStatus')
        let html = ''

        // Vérifier dataLayer
        if (window.dataLayer) {
          html +=
            '<div class="result success">✅ DataLayer présent (' +
            window.dataLayer.length +
            ' événements)</div>'
        } else {
          html += '<div class="result error">❌ DataLayer non trouvé</div>'
        }

        // Vérifier gtag
        if (window.gtag) {
          html += '<div class="result success">✅ gtag fonction disponible</div>'
        } else {
          html +=
            '<div class="result info">ℹ️ gtag non disponible (normal en mode dev sans ID réel)</div>'
        }

        // Vérifier GTM script
        const gtmScripts = document.querySelectorAll('script[src*="googletagmanager"]')
        if (gtmScripts.length > 0) {
          html += '<div class="result success">✅ Script GTM chargé</div>'
        } else {
          html += '<div class="result info">ℹ️ Script GTM non chargé (normal sans ID réel)</div>'
        }

        statusDiv.innerHTML = html
        updateDataLayerDisplay()
      }

      function testPhoneCall(source) {
        window.dataLayer.push({
          event: 'phone_call',
          event_category: 'engagement',
          event_label: source,
          phone_number: '0668314690',
          timestamp: new Date().toISOString(),
        })
        console.log('📞 Test appel:', source)
        updateDataLayerDisplay()
      }

      function testPageView(pageName) {
        window.dataLayer.push({
          event: 'page_view',
          event_category: 'navigation',
          page_name: pageName,
          timestamp: new Date().toISOString(),
        })
        console.log('📄 Test page vue:', pageName)
        updateDataLayerDisplay()
      }

      function testServiceClick(serviceType) {
        window.dataLayer.push({
          event: 'service_interest',
          event_category: 'engagement',
          service_type: serviceType,
          source: 'test_page',
          timestamp: new Date().toISOString(),
        })
        console.log('🛎️ Test service:', serviceType)
        updateDataLayerDisplay()
      }

      function testFormSubmission(success) {
        window.dataLayer.push({
          event: 'form_submission',
          event_category: 'form',
          event_label: 'contact_form',
          success: success,
          timestamp: new Date().toISOString(),
        })
        console.log('📝 Test formulaire:', success ? 'succès' : 'échec')
        updateDataLayerDisplay()
      }

      function updateDataLayerDisplay() {
        const content = document.getElementById('dataLayerContent')
        content.textContent = JSON.stringify(window.dataLayer, null, 2)
      }

      function clearDataLayer() {
        window.dataLayer.length = 0
        console.log('🗑️ DataLayer vidé')
        updateDataLayerDisplay()
      }

      // Initialiser l'affichage
      window.addEventListener('load', function () {
        checkGTMStatus()
      })
    </script>
  </body>
</html>
